cmake_minimum_required (VERSION 3.8)

project ("WineBDLauncher")

include (ExternalProject)

set (CMAKE_CXX_STANDARD 17)
set (CMAKE_CXX_STANDARD_REQUIRED ON)
set (CMAKE_CXX_EXTENSIONS ON)

function (find_and_install_package name)
    find_package (${name} CONFIG REQUIRED)
    get_target_property (dll_files ${name} IMPORTED_LOCATION_RELEASE)
    install (FILES ${dll_files} DESTINATION .)
endfunction ()

include_directories (Public)
add_compile_definitions (_UNICODE UNICODE NDEBUG)
add_compile_options (-Wno-invalid-offsetof -Wno-deprecated-declarations)

add_library (MinecraftHeaders INTERFACE)
file (GLOB_RECURSE MinecraftHeadersFiles MinecraftHeaders/*)
source_group (MinecraftHeaders FILES ${MinecraftHeadersFiles})
target_include_directories (MinecraftHeaders INTERFACE MinecraftHeaders)
target_link_directories (MinecraftHeaders INTERFACE Lib)
target_link_libraries (MinecraftHeaders INTERFACE bedrock_server_mod)

find_package (SQLiteCpp CONFIG REQUIRED)
find_package (Boost 1.72.0 REQUIRED)
find_and_install_package (sqlite3 CONFIG REQUIRED)
find_and_install_package (yaml-cpp CONFIG REQUIRED)

function (add_mod name)
    add_library (${name} SHARED ${ARGN})
    target_compile_definitions (${name} PRIVATE MODNAME=${name})
    target_link_libraries (${name} Boost::headers yaml-cpp ModLoader MinecraftHeaders Base)
    install (TARGETS ${name} RUNTIME DESTINATION Mods)
endfunction ()
function (add_base_mod name)
    add_library (${name} SHARED ${ARGN})
    target_compile_definitions (${name} PRIVATE MODNAME=${name})
    target_link_libraries (${name} Boost::headers yaml-cpp ModLoader MinecraftHeaders)
    install (TARGETS ${name} RUNTIME DESTINATION .)
endfunction ()
function (mod_link name)
    target_link_libraries (${name} ${ARGN})
endfunction ()

add_subdirectory ("ModLoader")
add_subdirectory ("Base")
add_subdirectory ("CommandSupport")
add_subdirectory ("Essentials")
add_subdirectory ("DebugTool")
